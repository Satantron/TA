{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useEffect, useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport StoryCard from \"../components/StoryCard\";\nimport usePagination from \"../utils/usePagination\";\nimport PaginationControls from \"../components/PaginationControls\";\nimport { fetchStories, fetchStoriesPage } from \"../supabase\";\nimport PdfViewerWeb from \"../components/PdfViewerWeb\";\nimport useWebBack from \"../utils/useWebBack\";\nimport { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function StoriesScreen(_ref) {\n  var navigation = _ref.navigation;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    stories = _useState2[0],\n    setStories = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    useServer = _useState4[0],\n    setUseServer = _useState4[1];\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      var res = yield fetchStories();\n      if (Array.isArray(res) && res.length) {\n        setStories(res);\n      } else {\n        setUseServer(false);\n        setStories([]);\n      }\n    })();\n  }, []);\n  var pager = usePagination({\n    items: stories,\n    fetchPage: useServer ? (function () {\n      var _ref3 = _asyncToGenerator(function* (page, pageSize) {\n        var result = yield fetchStoriesPage(page, pageSize);\n        return result;\n      });\n      return function (_x, _x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }()) : null,\n    initialPageSize: 8\n  });\n  function openStory(item) {\n    if (Platform.OS === 'web' && String(item.source_url).toLowerCase().endsWith('.pdf')) {\n      setStories(function (prev) {\n        var others = prev.filter(function (s) {\n          return s.id !== item.id;\n        });\n        return [item].concat(_toConsumableArray(others));\n      });\n    } else {\n      navigation.navigate('MythDetail', {\n        id: item.id,\n        name: item.title,\n        mythology: item.mythology,\n        short_desc: item.summary,\n        long_desc: item.content,\n        image_url: item.image_url,\n        source_url: item.source_url\n      });\n    }\n  }\n  if (Platform.OS === 'web') useWebBack(navigation);\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(Text, {\n      style: styles.title,\n      children: \"Stories\"\n    }), Platform.OS === 'web' && stories[0] && String(stories[0].source_url).toLowerCase().endsWith('.pdf') ? _jsx(PdfViewerWeb, {\n      url: stories[0].source_url\n    }) : null, pager.pageData.length === 0 ? _jsx(Text, {\n      style: {\n        color: '#888',\n        marginTop: 8\n      },\n      children: \"No stories yet.\"\n    }) : _jsxs(_Fragment, {\n      children: [_jsx(FlatList, {\n        data: pager.pageData,\n        keyExtractor: function keyExtractor(i) {\n          return String(i.id);\n        },\n        renderItem: function renderItem(_ref4) {\n          var item = _ref4.item;\n          return _jsx(StoryCard, {\n            item: item,\n            onPress: openStory\n          });\n        }\n      }), _jsx(PaginationControls, {\n        page: pager.page,\n        setPage: pager.setPage,\n        totalPages: pager.totalPages\n      })]\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    padding: 16,\n    backgroundColor: '#0b0b0b'\n  },\n  title: {\n    color: '#ffd166',\n    fontSize: 24,\n    marginBottom: 12\n  }\n});","map":{"version":3,"names":["React","useEffect","useState","View","Text","StyleSheet","FlatList","Platform","StoryCard","usePagination","PaginationControls","fetchStories","fetchStoriesPage","PdfViewerWeb","useWebBack","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","StoriesScreen","_ref","navigation","_useState","_useState2","_slicedToArray","stories","setStories","_useState3","_useState4","useServer","setUseServer","_asyncToGenerator","res","Array","isArray","length","pager","items","fetchPage","_ref3","page","pageSize","result","_x","_x2","apply","arguments","initialPageSize","openStory","item","OS","String","source_url","toLowerCase","endsWith","prev","others","filter","s","id","concat","_toConsumableArray","navigate","name","title","mythology","short_desc","summary","long_desc","content","image_url","style","styles","container","children","url","pageData","color","marginTop","data","keyExtractor","i","renderItem","_ref4","onPress","setPage","totalPages","create","flex","padding","backgroundColor","fontSize","marginBottom"],"sources":["C:/SoftEng/VScode/Javascript/TA/screens/StoriesScreen.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { View, Text, StyleSheet, FlatList, Platform } from 'react-native';\r\nimport StoryCard from '../components/StoryCard';\r\nimport usePagination from '../utils/usePagination';\r\nimport PaginationControls from '../components/PaginationControls';\r\nimport { fetchStories, fetchStoriesPage } from '../supabase';\r\nimport PdfViewerWeb from '../components/PdfViewerWeb';\r\nimport useWebBack from '../utils/useWebBack';\r\n\r\nexport default function StoriesScreen({ navigation }) {\r\n  const [stories, setStories] = useState([]);\r\n  const [useServer, setUseServer] = useState(true);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const res = await fetchStories();\r\n      if (Array.isArray(res) && res.length) {\r\n        setStories(res);\r\n      } else {\r\n        setUseServer(false);\r\n        setStories([]);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  const pager = usePagination({ items: stories, fetchPage: useServer ? async (page, pageSize) => {\r\n    const result = await fetchStoriesPage(page, pageSize);\r\n    return result;\r\n  } : null, initialPageSize: 8 });\r\n\r\n  function openStory(item) {\r\n    // If source is PDF, show inline viewer below the list header on web; otherwise open detail\r\n    if (Platform.OS === 'web' && String(item.source_url).toLowerCase().endsWith('.pdf')) {\r\n      // naive inline set: move story to top and render a viewer section\r\n      setStories((prev) => {\r\n        const others = prev.filter(s => s.id !== item.id);\r\n        return [item, ...others];\r\n      });\r\n    } else {\r\n      navigation.navigate('MythDetail', { id: item.id, name: item.title, mythology: item.mythology, short_desc: item.summary, long_desc: item.content, image_url: item.image_url, source_url: item.source_url });\r\n    }\r\n  }\r\n\r\n  if (Platform.OS === 'web') useWebBack(navigation);\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text style={styles.title}>Stories</Text>\r\n      {Platform.OS === 'web' && stories[0] && String(stories[0].source_url).toLowerCase().endsWith('.pdf') ? (\r\n        <PdfViewerWeb url={stories[0].source_url} />\r\n      ) : null}\r\n      {pager.pageData.length === 0 ? (\r\n        <Text style={{ color: '#888', marginTop: 8 }}>No stories yet.</Text>\r\n      ) : (\r\n        <>\r\n          <FlatList data={pager.pageData} keyExtractor={(i) => String(i.id)} renderItem={({ item }) => <StoryCard item={item} onPress={openStory} />} />\r\n          <PaginationControls page={pager.page} setPage={pager.setPage} totalPages={pager.totalPages} />\r\n        </>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: { flex: 1, padding: 16, backgroundColor: '#0b0b0b' },\r\n  title: { color: '#ffd166', fontSize: 24, marginBottom: 12 }\r\n});\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}